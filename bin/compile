#!/bin/bash

BUILD_DIR=$1

herokuEcho () { 
  echo "-----> $1"
}

herokuEcho "============================================"
herokuEcho "============================================"
herokuEcho "Lego Create React App + Typescript stack! 游"
herokuEcho "============================================"
herokuEcho "============================================"

# ====================================
# Let's get NodeJS goin'! 游꼭
# ====================================

herokuEcho "About to get NodeJS 游꼭"

relativeNodePackageDir="bin/node"
nodeDownloadDir="${BUILD_DIR}/{$relativeNodePackageDir}"
nodePathWithinPackage="bin"
absoluteNodePath="${nodeDownloadDir}/${nodePathWithinPackage}"

mkdir -p $nodeDownloadDir
curl -s https://nodejs.org/dist/v12.18.0/node-v12.18.0-linux-x64.tar.xz | tar --strip-components=1 -xJf - -C $nodeDownloadDir

herokuEcho "Successfully fetched NodeJS 游꼭 游깯"

herokuEcho $absoluteNodePath
PATH="$absoluteNodePath:$PATH"
herokuEcho $PATH
herokuEcho "IS THE PATH RIGHT? UP DERE?"

herokuEcho "Successfully added node to PATH 游띢 游꼭 游깯"

herokuEcho "Checking node works from PATH 游띢..."
herokuEcho "NodeJS version: $(node -v)"
herokuEcho "Yay! Good work Buildpack! Go you! 救넖잺救넖잺救넖잺救넖잺救넖잺"

# ====================================
# Get the PATH setup for the dynos! 游빋
# ====================================

herokuEcho "Time to add to the 游낿's path..."
mkdir -p $BUILD_DIR/.profile.d
echo "export PATH=\"\$HOME/$relativeNodePackageDir/$nodePathWithinPackage:\$PATH\"" > $BUILD_DIR/.profile.d/nodejs.sh