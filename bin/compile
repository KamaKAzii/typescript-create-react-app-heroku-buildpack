#!/bin/bash

BUILD_DIR=$1

herokuEcho () { 
  echo "-----> $1"
}

herokuEcho "============================================"
herokuEcho "============================================"
herokuEcho "Lego Create React App + Typescript stack! 🚀"
herokuEcho "============================================"
herokuEcho "============================================"

# ====================================
# Let's get NodeJS goin'! 🍢
# ====================================

herokuEcho "About to get NodeJS 🍢"
nodeBaseDir=$BUILD_DIR/bin/node
mkdir -p $nodeBaseDir
curl -s https://nodejs.org/dist/v12.18.0/node-v12.18.0-linux-x64.tar.xz | tar --strip-components=1 -xJf - -C $nodeBaseDir
nodePath="$nodeBaseDir/bin"
herokuEcho "Successfully fetched NodeJS 🍢 🌈"

PATH="$nodePath:$PATH"
herokuEcho "Successfully added node to PATH 🛣 🍢 🌈"
herokuEcho "Checking node works from PATH 🛣..."
herokuEcho "NodeJS version: $(node -v)"
herokuEcho "Yay! Good work Buildpack! Go you! ⭐️⭐️⭐️⭐️⭐️"

# ====================================
# Get the PATH setup for the dynos! 🧨
# ====================================

echo "-----> Building runtime environment"
mkdir -p $BUILD_DIR/.profile.d
echo "export PATH=\"$nodePath:\$PATH\"" > $BUILD_DIR/.profile.d/nodejs.sh
herokuEcho "What's in there... nodejs.sh"
cat $BUILD_DIR/.profile.d/nodejs.sh
herokuEcho "DID THAT DO WAHT WE THOUGHT? hmm..."
herokuEcho "What is home in here...: $HOME"
herokuEcho "What is build_dir in here...: $BUILD_DIR"
herokuEcho "Much to think about"